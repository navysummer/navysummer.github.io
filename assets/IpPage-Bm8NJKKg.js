import{_}from"./index-BNj57DdA.js";import{b as h,a as t,d as f,t as l,o as v}from"./vendor-DJAHsOyX.js";const m={data(){return{title:"IP工具",ipv4:"",ipv6:"",detail4:{},detail6:{},provider4:"",provider6:"",raw4:"",raw6:"",mac:"",toast:"",toastTimer:null,loading:!1,error:""}},computed:{macDisplay(){return this.mac||"不可获取（浏览器限制）"},jsonResult(){const e={ip:this.ipv4||"",provider:this.provider4||"",detail:this.detail4||{}},s={ip:this.ipv6||"",provider:this.provider6||"",detail:this.detail6||{}},p={ipv4:e,ipv6:s,mac:this.mac||""};try{return JSON.stringify(p,null,2)}catch{return""}}},mounted(){document.title=this.title,this.fetchIp()},methods:{copyJson(){this.jsonResult&&navigator.clipboard&&navigator.clipboard.writeText(this.jsonResult).then(()=>{this.showToast("JSON 已复制")}).catch(()=>{})},showToast(e){this.toastTimer&&(clearTimeout(this.toastTimer),this.toastTimer=null),this.toast=e||"",this.toastTimer=setTimeout(()=>{this.toast="",this.toastTimer=null},1500)},async fetchIp(){this.loading=!0,this.error="",this.ipv4="",this.ipv6="",this.detail4={},this.detail6={},this.raw4="",this.raw6="",this.provider4="",this.provider6="",this.mac="";const e=await this.getStunIPs();e&&e.v4&&!this.ipv4&&(this.ipv4=e.v4,this.provider4="stun",this.raw4=e.raw),e&&e.v6&&!this.ipv6&&(this.ipv6=e.v6,this.provider6="stun",this.raw6=e.raw);const s=async(i,r)=>{try{const a=await fetch(i,{cache:"no-store"});if(!a.ok)throw new Error(`status ${a.status}`);const u=await a.json().catch(()=>null),w=u?JSON.stringify(u,null,2):await a.text(),d=r(u,w);if(d.ip)return{ip:d.ip,detail:d.detail||{},raw:w,provider:d.provider}}catch{}return null},p=i=>!i||!/^(\\d{1,3}(?:\\.\\d{1,3}){3})$/.test(i)?!1:i.split(".").map(a=>parseInt(a,10)).every(a=>a>=0&&a<=255),c=i=>!!i&&i.includes(":"),o=[["https://api.ipify.org?format=json",(i,r)=>({ip:i&&i.ip,detail:{},provider:"ipify",raw:r})],["https://ipapi.co/json",(i,r)=>({ip:i&&i.ip,detail:i||{},provider:"ipapi",raw:r})],["https://ipinfo.io/json",(i,r)=>({ip:i&&i.ip,detail:i||{},provider:"ipinfo",raw:r})]];for(const[i,r]of o){const a=await s(i,r);if(a&&p(a.ip)){this.ipv4=a.ip,this.detail4=a.detail,this.raw4=a.raw,this.provider4=a.provider;break}}const n=[["https://api64.ipify.org?format=json",(i,r)=>({ip:i&&i.ip,detail:{},provider:"ipify-v6",raw:r})],["https://ipapi.co/json",(i,r)=>({ip:i&&i.ip,detail:i||{},provider:"ipapi",raw:r})],["https://ipinfo.io/json",(i,r)=>({ip:i&&i.ip,detail:i||{},provider:"ipinfo",raw:r})]];for(const[i,r]of n){const a=await s(i,r);if(a&&c(a.ip)){this.ipv6=a.ip,this.detail6=a.detail,this.raw6=a.raw,this.provider6=a.provider;break}}await this.fetchDetailFor(this.ipv4,!1),await this.fetchDetailFor(this.ipv6,!0),this.mac=this.detail4&&(this.detail4.mac||this.detail4.mac_address)||this.detail6&&(this.detail6.mac||this.detail6.mac_address)||"",!this.ipv4&&!this.ipv6?this.error="获取失败，请稍后重试":this.showToast("获取成功"),this.loading=!1},async fetchDetailFor(e,s){if(!e)return;const p=(o,n,i)=>{s?(this.detail6=o||{},this.raw6=n||"",this.provider6=i||this.provider6):(this.detail4=o||{},this.raw4=n||"",this.provider4=i||this.provider4)},c=async(o,n)=>{try{const i=await fetch(o,{cache:"no-store"});if(!i.ok)return!1;const r=await i.json().catch(()=>null),a=r?JSON.stringify(r,null,2):await i.text();return p(r||{},a,n),!0}catch{return!1}};await c(`https://ipapi.co/${e}/json/`,"ipapi-detail")||await c(`https://ipwho.is/${e}`,"ipwhois-detail")||await c(`https://api.ip.sb/geoip/${e}`,"ipsb-detail")||await c(`https://ipinfo.io/${e}/json`,"ipinfo-detail")},async getStunIPs(){try{const e={v4:"",v6:"",raw:""},s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});s.createDataChannel("x");const p=[];s.onicecandidate=o=>{if(!o||!o.candidate)return;const n=o.candidate.candidate||"";if(!(n.includes("typ srflx")||n.includes("typ relay")))return;p.push(n);const i=n.match(/([0-9]{1,3}(?:\.[0-9]{1,3}){3})/),r=n.match(/([0-9a-fA-F]{0,4}(?::[0-9a-fA-F]{0,4}){2,7})/);i&&!e.v4&&(e.v4=i[1]),r&&!e.v6&&(e.v6=r[1])};const c=await s.createOffer();return await s.setLocalDescription(c),await new Promise(o=>{s.iceGatheringState==="complete"?o():s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&o()}}),s.close(),e.raw=p.join(`
`),e}catch{return null}},copyIp4(){this.ipv4&&navigator.clipboard&&navigator.clipboard.writeText(this.ipv4).then(()=>this.showToast("IPv4 已复制")).catch(()=>{})},copyIp6(){this.ipv6&&navigator.clipboard&&navigator.clipboard.writeText(this.ipv6).then(()=>this.showToast("IPv6 已复制")).catch(()=>{})}}},y={class:"ip-wrap"},g={class:"topbar"},b=["disabled"],k=["disabled"],I={key:0},j={key:1,class:"err"},T={class:"content"},P={class:"pane"},x={class:"result"},S={class:"row"},C={class:"v"},J={class:"row"},D={class:"v"},N={class:"row"},O={class:"v"},F={class:"row"},R={class:"v"},A={class:"row"},B={class:"v"},G={class:"row"},E={class:"v"},V={class:"row"},L={class:"v"},M={class:"row"},q={class:"v"},z={class:"row"},H={class:"v"},K={class:"row"},Q={class:"v"},U={class:"row"},W={class:"v"},X={class:"row"},Y={class:"v"},Z={class:"row"},$={class:"v"},ss={class:"row"},ts={class:"v"},is={class:"row"},os={class:"v"},es={class:"pane"},rs=["disabled"],as={class:"code"},ns={key:0,class:"toast"};function ls(e,s,p,c,o,n){return v(),h("div",y,[t("div",g,[s[4]||(s[4]=t("span",{class:"lbl"},"公网IP",-1)),t("button",{class:"btn",onClick:s[0]||(s[0]=(...i)=>n.fetchIp&&n.fetchIp(...i))}," 获取 "),t("button",{class:"btn",disabled:!o.ipv4,onClick:s[1]||(s[1]=(...i)=>n.copyIp4&&n.copyIp4(...i))}," 复制IPv4 ",8,b),t("button",{class:"btn",disabled:!o.ipv6,onClick:s[2]||(s[2]=(...i)=>n.copyIp6&&n.copyIp6(...i))}," 复制IPv6 ",8,k),o.loading?(v(),h("span",I,"加载中...")):f("",!0),o.error?(v(),h("span",j,l(o.error),1)):f("",!0)]),t("div",T,[t("div",P,[s[20]||(s[20]=t("h3",null,"结果",-1)),t("div",x,[t("div",S,[s[5]||(s[5]=t("span",{class:"k"},"IPv4",-1)),t("span",C,l(o.ipv4||"-"),1)]),t("div",J,[s[6]||(s[6]=t("span",{class:"k"},"城市",-1)),t("span",D,l(o.detail4.city||"-"),1)]),t("div",N,[s[7]||(s[7]=t("span",{class:"k"},"区域",-1)),t("span",O,l(o.detail4.region||"-"),1)]),t("div",F,[s[8]||(s[8]=t("span",{class:"k"},"国家",-1)),t("span",R,l(o.detail4.country||"-"),1)]),t("div",A,[s[9]||(s[9]=t("span",{class:"k"},"位置",-1)),t("span",B,l(o.detail4.loc||"-"),1)]),t("div",G,[s[10]||(s[10]=t("span",{class:"k"},"组织",-1)),t("span",E,l(o.detail4.org||"-"),1)]),t("div",V,[s[11]||(s[11]=t("span",{class:"k"},"来源",-1)),t("span",L,l(o.provider4||"-"),1)]),t("div",M,[s[12]||(s[12]=t("span",{class:"k"},"IPv6",-1)),t("span",q,l(o.ipv6||"-"),1)]),t("div",z,[s[13]||(s[13]=t("span",{class:"k"},"城市",-1)),t("span",H,l(o.detail6.city||"-"),1)]),t("div",K,[s[14]||(s[14]=t("span",{class:"k"},"区域",-1)),t("span",Q,l(o.detail6.region||"-"),1)]),t("div",U,[s[15]||(s[15]=t("span",{class:"k"},"国家",-1)),t("span",W,l(o.detail6.country||"-"),1)]),t("div",X,[s[16]||(s[16]=t("span",{class:"k"},"位置",-1)),t("span",Y,l(o.detail6.loc||"-"),1)]),t("div",Z,[s[17]||(s[17]=t("span",{class:"k"},"组织",-1)),t("span",$,l(o.detail6.org||"-"),1)]),t("div",ss,[s[18]||(s[18]=t("span",{class:"k"},"来源",-1)),t("span",ts,l(o.provider6||"-"),1)]),t("div",is,[s[19]||(s[19]=t("span",{class:"k"},"MAC地址",-1)),t("span",os,l(n.macDisplay),1)])])]),t("div",es,[s[21]||(s[21]=t("h3",null,"JSON结果",-1)),t("button",{class:"btn",disabled:!n.jsonResult,onClick:s[3]||(s[3]=(...i)=>n.copyJson&&n.copyJson(...i))}," 复制JSON ",8,rs),t("pre",as,l(n.jsonResult),1)])]),o.toast?(v(),h("div",ns,l(o.toast),1)):f("",!0)])}const ds=_(m,[["render",ls],["__scopeId","data-v-2c6f185e"]]);export{ds as default};

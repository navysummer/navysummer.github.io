import{H as c}from"./hls-BGvSEJpu.js";import{f as h,g as o,j as d,n as y,p as m,s as f,F as p,m as g,q as v,o as a,t as b}from"./vendor-Bp3o8l42.js";import{_ as w}from"./index-CIlc6CiH.js";const k={name:"VideoOnlinePlayer",data(){return{url:"",mode:"network",file:null,fileName:"",objectUrl:null,player:null,hls:null,showHistory:!1,historyKey:"videoPlayerHistory",history:[]}},watch:{mode(e){if(e==="network"&&this.objectUrl){try{URL.revokeObjectURL(this.objectUrl)}catch{}this.objectUrl=null,this.file=null,this.fileName=""}}},mounted(){this.initPlayer(),this.loadHistory(),this.url="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",this.onPlay()},beforeUnmount(){if(this.hls){try{this.hls.destroy()}catch{}this.hls=null}if(this.objectUrl){try{URL.revokeObjectURL(this.objectUrl)}catch{}this.objectUrl=null}},methods:{initPlayer(){this.$refs.videoEl.addEventListener("error",()=>{const t=(this.url||"").trim();this.isHlsFormat(t)&&this.useHlsPlayback(t)})},onPlay(){const e=this.$refs.videoEl;if(this.mode==="local"){if(!this.file){alert("请选择本地视频文件");return}if(!this.objectUrl)try{this.objectUrl=URL.createObjectURL(this.file)}catch{alert("无法创建文件链接");return}e.src=this.objectUrl;try{e.muted=!0}catch{}const s=e.play();s&&typeof s.then=="function"&&s.catch(()=>{});return}const t=(this.url||"").trim();if(!this.isValidVideoUrl(t)){alert("请输入有效的视频地址（http/https，支持 mp4/m3u8/m3u/ts/webm/ogg）");return}if(this.isHlsFormat(t))this.useHlsPlayback(t);else{e.src=t;try{e.muted=!0}catch{}const s=e.play();s&&typeof s.then=="function"&&s.catch(()=>{})}this.addHistory(t)},onFileChange(e){const t=e&&e.target&&e.target.files&&e.target.files[0];if(!t){this.file=null,this.fileName="";return}const s=["video/mp4","video/webm","video/ogg","video/mp2t"];if(t.type&&t.type.indexOf("video")!==0&&!s.includes(t.type)){const l=(t.name||"").toLowerCase();if(!(l.endsWith(".mp4")||l.endsWith(".webm")||l.endsWith(".ogg")||l.endsWith(".mkv")||l.endsWith(".m3u8")||l.endsWith(".m3u")||l.endsWith(".ts"))){alert("请选择视频文件（mp4/webm/ogg/m3u8/m3u/ts）"),this.$refs.fileInput.value="",this.file=null,this.fileName="";return}}if(this.file=t,this.fileName=t.name||"",this.objectUrl){try{URL.revokeObjectURL(this.objectUrl)}catch{}this.objectUrl=null}},toggleHistory(){this.showHistory=!this.showHistory},playHistory(e){this.url=e,this.toggleHistory(),this.onPlay()},isHlsFormat(e){const t=(e||"").toLowerCase();return t.endsWith(".m3u8")||t.endsWith(".m3u")||t.includes(".m3u8?")||t.includes(".m3u?")},isValidVideoUrl(e){try{const t=new URL(e);if(!(t.protocol==="http:"||t.protocol==="https:"))return!1;const s=t.pathname.toLowerCase();return s.endsWith(".mp4")||s.endsWith(".webm")||s.endsWith(".ogg")||s.endsWith(".m3u8")||s.endsWith(".m3u")||s.endsWith(".ts")}catch{return!1}},getMimeType(e){const t=e.toLowerCase();return t.endsWith(".m3u8")?"application/x-mpegURL":t.endsWith(".mp4")?"video/mp4":t.endsWith(".webm")?"video/webm":t.endsWith(".ogg")?"video/ogg":"video/mp4"},useHlsPlayback(e){if(this.hls){try{this.hls.destroy()}catch{}this.hls=null}const t=this.$refs.videoEl;if(c.isSupported())this.hls=new c({enableWorker:!0,lowLatencyMode:!0}),this.hls.loadSource(e),this.hls.attachMedia(t),this.hls.on(c.Events.MEDIA_ATTACHED,()=>{try{t.muted=!0}catch{}const s=t.play();s&&typeof s.then=="function"&&s.catch(()=>{})}),this.hls.on(c.Events.ERROR,(s,l)=>{if(l.fatal)switch(l.type){case c.ErrorTypes.NETWORK_ERROR:this.hls.startLoad();break;case c.ErrorTypes.MEDIA_ERROR:this.hls.recoverMediaError();break;default:try{this.hls.destroy()}catch{}this.hls=null}});else{t.src=e;try{t.muted=!0}catch{}const s=t.play();s&&typeof s.then=="function"&&s.catch(()=>{})}},loadHistory(){try{const e=localStorage.getItem(this.historyKey),t=e?JSON.parse(e):[];this.history=Array.isArray(t)?t:[]}catch{this.history=[]}},addHistory(e){if(!this.isValidVideoUrl(e))return;const t=new Set([e,...this.history]);this.history=Array.from(t).slice(0,50),localStorage.setItem(this.historyKey,JSON.stringify(this.history))},clearHistory(){this.history=[],localStorage.removeItem(this.historyKey)}}},H={class:"online-player"},U={class:"controls"},_={key:0},j={key:1,class:"file-input-wrapper"},W={class:"player-box"},R={id:"videojs-player",ref:"videoEl",class:"video-js vjs-default-skin",controls:"",preload:"auto",playsinline:"",crossorigin:"anonymous"},E={class:"modal-content"},L={class:"modal-header"},C={key:0,class:"empty"},x={key:1,class:"history-list"},O=["onClick"],P={class:"modal-footer"};function V(e,t,s,l,n,r){return a(),h("div",H,[t[10]||(t[10]=o("h2",{class:"title"}," 海军在线视频播放器 ",-1)),o("div",U,[d(o("select",{"onUpdate:modelValue":t[0]||(t[0]=i=>n.mode=i),class:"mode-select"},[...t[8]||(t[8]=[o("option",{value:"network"}," 网络视频 ",-1),o("option",{value:"local"}," 本地视频 ",-1)])],512),[[y,n.mode]]),n.mode==="network"?(a(),h("div",_,[d(o("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>n.url=i),class:"input",type:"text",placeholder:"请输入视频地址（支持 mp4/m3u8/m3u/ts/webm/ogg）"},null,512),[[m,n.url]])])):(a(),h("div",j,[o("input",{ref:"fileInput",class:"input file-input",type:"file",accept:"video/mp4,video/webm,video/ogg,video/*,.m3u8,.m3u,.ts",onChange:t[2]||(t[2]=(...i)=>r.onFileChange&&r.onFileChange(...i))},null,544)])),o("button",{class:"btn play",onClick:t[3]||(t[3]=(...i)=>r.onPlay&&r.onPlay(...i))}," 播放 "),o("button",{class:"btn history",onClick:t[4]||(t[4]=(...i)=>r.toggleHistory&&r.toggleHistory(...i))}," 历史记录 ")]),o("div",W,[o("video",R,null,512)]),n.showHistory?(a(),h("div",{key:0,class:"modal",onClick:t[7]||(t[7]=f((...i)=>r.toggleHistory&&r.toggleHistory(...i),["self"]))},[o("div",E,[o("div",L,[t[9]||(t[9]=o("span",null,"播放历史",-1)),o("button",{class:"close",onClick:t[5]||(t[5]=(...i)=>r.toggleHistory&&r.toggleHistory(...i))}," × ")]),n.history.length===0?(a(),h("div",C," 暂无记录 ")):(a(),h("ul",x,[(a(!0),h(p,null,g(n.history,(i,u)=>(a(),h("li",{key:u},[o("button",{class:"link",onClick:N=>r.playHistory(i)},b(i),9,O)]))),128))])),o("div",P,[o("button",{class:"btn clear",onClick:t[6]||(t[6]=(...i)=>r.clearHistory&&r.clearHistory(...i))}," 清空历史 ")])])])):v("",!0)])}const I=w(k,[["render",V],["__scopeId","data-v-b90bef9d"]]);export{I as default};

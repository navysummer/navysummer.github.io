import{b as c,a as s,t as b,x as u,k as l,v,l as a,F as m,n as h,p as f,q as g,j as _,o as p}from"./vendor-yjUBYCCz.js";import{_ as x}from"./index-BHSFjLNm.js";const k={name:"EmbeddedToolPage",data(){return{title:"调试器配置",currentStep:1,chipFamilies:["stm32","gd32","stc"],seriesMap:{stm32:["stm32f1","stm32f4","stm32h7"],gd32:["gd32f1","gd32f4"],stc:["stc89","stc12"]},chipFamily:"",chipSeries:"",chipModel:"",installPath:"",debuggerType:"openocd",debuggerInterface:"swd",toolConfig:"",ldScript:"",svdContent:""}},computed:{canProceed(){return this.currentStep===1?!!this.chipFamily:this.currentStep===2?!!this.chipSeries:this.currentStep===3?!!this.chipModel:this.currentStep===4?!!this.installPath:this.currentStep===5?!!this.debuggerType&&!!this.debuggerInterface:!1},seriesOptions(){return this.seriesMap[this.chipFamily]||[]}},watch:{chipFamily(){this.seriesOptions.includes(this.chipSeries)||(this.chipSeries="")}},mounted(){document.title=this.title},methods:{nextStep(){this.canProceed&&this.currentStep<5&&(this.currentStep+=1)},prevStep(){this.currentStep>1&&(this.currentStep-=1)},getMemoryMap(o){return{stm32f1:{flash:"256K",ram:"64K"},stm32f4:{flash:"1024K",ram:"192K"},stm32h7:{flash:"2048K",ram:"512K"},gd32f1:{flash:"256K",ram:"64K"},gd32f4:{flash:"512K",ram:"128K"},stc89:{flash:"64K",ram:"4K"},stc12:{flash:"128K",ram:"8K"}}[o]||{flash:"256K",ram:"64K"}},buildOpenOcd(o,e,d,r){const t={stm32f1:"stm32f1x",stm32f4:"stm32f4x",stm32h7:"stm32h7x",gd32f1:"gd32f1x",gd32f4:"gd32f4x",stc89:"stc89",stc12:"stc12"},n={swd:{driver:"cmsis-dap",transport:"swd"},jtag:{driver:"jlink",transport:"jtag"},dap:{driver:"cmsis-dap",transport:"swd"},stlink:{driver:"stlink",transport:"swd"},jlink:{driver:"jlink",transport:"swd"},ulink:{driver:"ulink",transport:"swd"}},i=n[r]||n.swd,S=t[o]||o,y=e||o;return[`set TOOL_PATH ${d}`,`adapter driver ${i.driver}`,`transport select ${i.transport}`,`set CHIP ${y}`,`source [find target/${S}.cfg]`].join(`
`)},buildProbeRs(o,e,d){const r={swd:{probe:"auto",protocol:"swd"},jtag:{probe:"auto",protocol:"jtag"},dap:{probe:"cmsis-dap",protocol:"swd"},stlink:{probe:"stlink",protocol:"swd"},jlink:{probe:"jlink",protocol:"swd"},ulink:{probe:"ulink",protocol:"swd"}},t=r[d]||r.swd;return[`chip = "${o}"`,`probe = "${t.probe}"`,`protocol = "${t.protocol}"`,"speed = 4000",`install_path = "${e}"`].join(`
`)},buildPyOcd(o,e,d){const r={swd:{probe:"swd",frequency:4e6},jtag:{probe:"jtag",frequency:4e6},dap:{probe:"cmsis-dap",frequency:4e6},stlink:{probe:"stlink",frequency:4e6},jlink:{probe:"jlink",frequency:4e6},ulink:{probe:"ulink",frequency:4e6}},t=r[d]||r.swd;return["target:",`  name: ${o}`,"probe:",`  type: ${t.probe}`,`  frequency: ${t.frequency}`,"session:","  gdbserver_port: 3333",`  install_path: ${e}`].join(`
`)},buildLd(o){const e=this.getMemoryMap(o);return["ENTRY(Reset_Handler)","MEMORY","{",`  FLASH (rx) : ORIGIN = 0x08000000, LENGTH = ${e.flash}`,`  RAM (xrw) : ORIGIN = 0x20000000, LENGTH = ${e.ram}`,"}","_estack = ORIGIN(RAM) + LENGTH(RAM);","_Min_Heap_Size = 0x200;","_Min_Stack_Size = 0x400;","SECTIONS","{","  .isr_vector :","  {","    . = ALIGN(4);","    KEEP(*(.isr_vector))","    . = ALIGN(4);","  } > FLASH","  .text :","  {","    . = ALIGN(4);","    *(.text*)","    *(.rodata*)","    *(.glue_7)","    *(.glue_7t)","    *(.eh_frame)","    . = ALIGN(4);","    _etext = .;","  } > FLASH","  .ARM.exidx :","  {","    __exidx_start = .;","    *(.ARM.exidx*)","    __exidx_end = .;","  } > FLASH","  .data : AT (ADDR(.text) + SIZEOF(.text))","  {","    . = ALIGN(4);","    _sdata = .;","    *(.data*)","    . = ALIGN(4);","    _edata = .;","  } > RAM","  _sidata = LOADADDR(.data);","  .bss :","  {","    . = ALIGN(4);","    _sbss = .;","    *(.bss*)","    *(COMMON)","    . = ALIGN(4);","    _ebss = .;","  } > RAM","  ._user_heap_stack :","  {","    . = ALIGN(8);","    PROVIDE(end = .);","    PROVIDE(_end = .);","    . = . + _Min_Heap_Size;","    . = . + _Min_Stack_Size;","    . = ALIGN(8);","  } > RAM","}"].join(`
`)},buildSvd(o,e){const d=this.getMemoryMap(o),r=e||o,n={stm32f1:"CM3",stm32f4:"CM4",stm32h7:"CM7",gd32f1:"CM3",gd32f4:"CM4",stc89:"CM3",stc12:"CM3"}[o]||"CM3";return['<?xml version="1.0" encoding="UTF-8"?>',"<device>",`  <name>${r}</name>`,`  <series>${o}</series>`,"  <version>1.0</version>",`  <description>${r} Device</description>`,"  <vendor>Generic</vendor>","  <vendorID>GEN</vendorID>","  <addressUnitBits>8</addressUnitBits>","  <width>32</width>","  <size>32</size>","  <access>read-write</access>","  <resetValue>0x00000000</resetValue>","  <resetMask>0xFFFFFFFF</resetMask>","  <cpu>",`    <name>${n}</name>`,"    <revision>r0p0</revision>","    <endian>little</endian>","    <mpuPresent>false</mpuPresent>","    <fpuPresent>false</fpuPresent>","    <nvicPrioBits>4</nvicPrioBits>","    <vendorSystickConfig>false</vendorSystickConfig>","  </cpu>","  <memoryRegions>",`    <memoryRegion name="FLASH" type="Flash" start="0x08000000" size="${this.formatHexBytes(d.flash)}" />`,`    <memoryRegion name="RAM" type="RAM" start="0x20000000" size="${this.formatHexBytes(d.ram)}" />`,"  </memoryRegions>","  <peripherals>","    <peripheral>","      <name>PERIPH0</name>","      <baseAddress>0x40000000</baseAddress>","      <addressBlock>","        <offset>0x0</offset>","        <size>0x1000</size>","        <usage>registers</usage>","      </addressBlock>","      <registers>","        <register>","          <name>CTRL</name>","          <description>Control Register</description>","          <addressOffset>0x0</addressOffset>","          <size>32</size>","          <access>read-write</access>","          <resetValue>0x00000000</resetValue>","          <fields>","            <field>","              <name>EN</name>","              <bitOffset>0</bitOffset>","              <bitWidth>1</bitWidth>","            </field>","          </fields>","        </register>","      </registers>","    </peripheral>","  </peripherals>","</device>"].join(`
`)},formatHexBytes(o){return`0x${this.sizeToBytes(o).toString(16).toUpperCase()}`},sizeToBytes(o){if(typeof o=="number")return o;const d=String(o||"").trim().toUpperCase().match(/^(\d+)(K|M)?$/);if(!d)return 0;let r=Number(d[1]);return d[2]==="K"&&(r*=1024),d[2]==="M"&&(r*=1024*1024),r},generateFiles(){if(!this.canProceed)return;const o=this.installPath||"/opt/tools",e=this.chipSeries||this.chipFamily||"stm32f1",d=this.chipModel||e;this.debuggerType==="openocd"?this.toolConfig=this.buildOpenOcd(e,d,o,this.debuggerInterface):this.debuggerType==="probe-rs"?this.toolConfig=this.buildProbeRs(d,o,this.debuggerInterface):this.toolConfig=this.buildPyOcd(d,o,this.debuggerInterface),this.ldScript=this.buildLd(e),this.svdContent=this.buildSvd(e,d)},copyConfig(){this.toolConfig&&navigator.clipboard&&navigator.clipboard.writeText(this.toolConfig)},copyLd(){this.ldScript&&navigator.clipboard&&navigator.clipboard.writeText(this.ldScript)},downloadConfig(){if(!this.toolConfig)return;const o=`${this.debuggerType}-${this.fileSuffix()}.cfg`;this.downloadFile(this.toolConfig,o)},downloadLd(){if(!this.ldScript)return;const o=`${this.fileSuffix()}.ld`;this.downloadFile(this.ldScript,o)},downloadSvd(){if(!this.svdContent)return;const o=`${this.fileSuffix()}.svd`;this.downloadFile(this.svdContent,o)},fileSuffix(){return(this.chipModel||this.chipSeries||this.chipFamily||"chip").toLowerCase()},downloadFile(o,e){const d=new Blob([o],{type:"text/plain;charset=utf-8"}),r=document.createElement("a");r.href=URL.createObjectURL(d),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)},openDirPicker(){this.$refs.dirPicker&&this.$refs.dirPicker.click()},onDirPicked(o){const e=Array.from(o.target.files||[]);if(!e.length)return;const d=o.target.value||"",r=e[0].name||"";this.installPath=d||r||this.installPath}}},C={class:"gateway-wrap"},w={class:"header"},M={class:"title"},P={class:"steps"},L={class:"form-card"},F={class:"panel"},A={class:"section"},R={class:"section-body"},I={class:"form-row"},T={class:"control"},N=["value"],O={class:"panel"},j={class:"section"},D={class:"section-body"},G={class:"form-row"},K={class:"control"},E=["value"],H={class:"panel"},U={class:"section"},V={class:"section-body"},q={class:"form-row"},z={class:"control"},B={class:"panel"},W={class:"section"},J={class:"section-body"},Y={class:"form-row"},Z={class:"control"},Q={class:"panel"},X={class:"section"},$={class:"section-title"},ee={class:"section-actions"},se=["disabled"],te=["disabled"],ie={class:"section-body"},oe={class:"form-row"},ne={class:"control"},re={class:"form-row"},de={class:"control"},le=["value"],ae={class:"section"},ce={class:"section-title"},pe={class:"section-actions"},ue=["disabled"],ve=["disabled"],fe={class:"section-body"},be=["value"],me={class:"section"},he={class:"section-title"},ge={class:"section-actions"},Se=["disabled"],ye={class:"section-body"},_e=["value"],xe={class:"footer-actions"},ke=["disabled"],Ce=["disabled"],we=["disabled"];function Me(o,e,d,r,t,n){return p(),c("div",C,[s("div",w,[s("div",M,b(t.title),1)]),s("div",P,[s("div",{class:u(["step",{active:t.currentStep===1,done:t.currentStep>1}])},[...e[17]||(e[17]=[s("div",{class:"step-index"}," 1 ",-1),s("div",{class:"step-text"}," 选择芯片大类 ",-1)])],2),e[22]||(e[22]=s("div",{class:"step-line"},null,-1)),s("div",{class:u(["step",{active:t.currentStep===2,done:t.currentStep>2}])},[...e[18]||(e[18]=[s("div",{class:"step-index"}," 2 ",-1),s("div",{class:"step-text"}," 选择子类 ",-1)])],2),e[23]||(e[23]=s("div",{class:"step-line"},null,-1)),s("div",{class:u(["step",{active:t.currentStep===3,done:t.currentStep>3}])},[...e[19]||(e[19]=[s("div",{class:"step-index"}," 3 ",-1),s("div",{class:"step-text"}," 输入芯片型号 ",-1)])],2),e[24]||(e[24]=s("div",{class:"step-line"},null,-1)),s("div",{class:u(["step",{active:t.currentStep===4,done:t.currentStep>4}])},[...e[20]||(e[20]=[s("div",{class:"step-index"}," 4 ",-1),s("div",{class:"step-text"}," 选择可执行文件 ",-1)])],2),e[25]||(e[25]=s("div",{class:"step-line"},null,-1)),s("div",{class:u(["step",{active:t.currentStep===5,done:t.currentStep>5}])},[...e[21]||(e[21]=[s("div",{class:"step-index"}," 5 ",-1),s("div",{class:"step-text"}," 生成配置文件 ",-1)])],2)]),s("div",L,[l(s("div",F,[s("div",A,[e[28]||(e[28]=s("div",{class:"section-title"}," 芯片大类 ",-1)),s("div",R,[s("div",I,[e[27]||(e[27]=s("div",{class:"label"},[s("span",{class:"required"},"*"),a("芯片大类 ")],-1)),s("div",T,[l(s("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>t.chipFamily=i),class:"input"},[e[26]||(e[26]=s("option",{value:""}," 请选择 ",-1)),(p(!0),c(m,null,h(t.chipFamilies,i=>(p(),c("option",{key:i,value:i},b(i),9,N))),128))],512),[[f,t.chipFamily]])])])])])],512),[[v,t.currentStep===1]]),l(s("div",O,[s("div",j,[e[31]||(e[31]=s("div",{class:"section-title"}," 芯片子类 ",-1)),s("div",D,[s("div",G,[e[30]||(e[30]=s("div",{class:"label"},[s("span",{class:"required"},"*"),a("芯片子类 ")],-1)),s("div",K,[l(s("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.chipSeries=i),class:"input"},[e[29]||(e[29]=s("option",{value:""}," 请选择 ",-1)),(p(!0),c(m,null,h(n.seriesOptions,i=>(p(),c("option",{key:i,value:i},b(i),9,E))),128))],512),[[f,t.chipSeries]])])])])])],512),[[v,t.currentStep===2]]),l(s("div",H,[s("div",U,[e[33]||(e[33]=s("div",{class:"section-title"}," 芯片型号 ",-1)),s("div",V,[s("div",q,[e[32]||(e[32]=s("div",{class:"label"},[s("span",{class:"required"},"*"),a("芯片型号 ")],-1)),s("div",z,[l(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.chipModel=i),class:"input",placeholder:"例如 STM32F103C8T6"},null,512),[[g,t.chipModel]])])])])])],512),[[v,t.currentStep===3]]),l(s("div",B,[s("div",W,[e[35]||(e[35]=s("div",{class:"section-title"}," 可执行文件 ",-1)),s("div",J,[s("div",Y,[e[34]||(e[34]=s("div",{class:"label"},[s("span",{class:"required"},"*"),a("可执行文件 ")],-1)),s("div",Z,[l(s("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>t.installPath=i),class:"input",placeholder:"请选择调试器可执行文件",readonly:""},null,512),[[g,t.installPath]]),s("button",{class:"btn ghost",onClick:e[4]||(e[4]=(...i)=>n.openDirPicker&&n.openDirPicker(...i))}," 选择文件 "),s("input",{ref:"dirPicker",class:"dir-input",type:"file",onChange:e[5]||(e[5]=(...i)=>n.onDirPicked&&n.onDirPicked(...i))},null,544)])])])])],512),[[v,t.currentStep===4]]),l(s("div",Q,[s("div",X,[s("div",$,[e[36]||(e[36]=a(" 配置文件 ",-1)),s("div",ee,[s("button",{class:"btn",onClick:e[6]||(e[6]=(...i)=>n.generateFiles&&n.generateFiles(...i))}," 生成 "),s("button",{class:"btn",disabled:!t.toolConfig,onClick:e[7]||(e[7]=(...i)=>n.copyConfig&&n.copyConfig(...i))}," 复制 ",8,se),s("button",{class:"btn",disabled:!t.toolConfig,onClick:e[8]||(e[8]=(...i)=>n.downloadConfig&&n.downloadConfig(...i))}," 下载 ",8,te)])]),s("div",ie,[s("div",oe,[e[38]||(e[38]=s("div",{class:"label"},[s("span",{class:"required"},"*"),a("调试器 ")],-1)),s("div",ne,[l(s("select",{"onUpdate:modelValue":e[9]||(e[9]=i=>t.debuggerType=i),class:"input"},[...e[37]||(e[37]=[s("option",{value:"openocd"}," openocd ",-1),s("option",{value:"probe-rs"}," probe-rs ",-1),s("option",{value:"pyocd"}," pyocd ",-1)])],512),[[f,t.debuggerType]])])]),s("div",re,[e[40]||(e[40]=s("div",{class:"label"},[s("span",{class:"required"},"*"),a("调试器接口 ")],-1)),s("div",de,[l(s("select",{"onUpdate:modelValue":e[10]||(e[10]=i=>t.debuggerInterface=i),class:"input"},[...e[39]||(e[39]=[_('<option value="swd" data-v-772a3e52> SWD </option><option value="jtag" data-v-772a3e52> JTAG </option><option value="dap" data-v-772a3e52> DAP </option><option value="stlink" data-v-772a3e52> STLink </option><option value="jlink" data-v-772a3e52> JLink </option><option value="ulink" data-v-772a3e52> ULink </option>',6)])],512),[[f,t.debuggerInterface]])])]),s("textarea",{class:"config-output",readonly:"",value:t.toolConfig},null,8,le)])]),e[43]||(e[43]=s("div",{class:"divider"},null,-1)),s("div",ae,[s("div",ce,[e[41]||(e[41]=a(" LD 文件 ",-1)),s("div",pe,[s("button",{class:"btn",disabled:!t.ldScript,onClick:e[11]||(e[11]=(...i)=>n.copyLd&&n.copyLd(...i))}," 复制 ",8,ue),s("button",{class:"btn",disabled:!t.ldScript,onClick:e[12]||(e[12]=(...i)=>n.downloadLd&&n.downloadLd(...i))}," 下载 ",8,ve)])]),s("div",fe,[s("textarea",{class:"config-output",readonly:"",value:t.ldScript},null,8,be)])]),e[44]||(e[44]=s("div",{class:"divider"},null,-1)),s("div",me,[s("div",he,[e[42]||(e[42]=a(" SVD 文件 ",-1)),s("div",ge,[s("button",{class:"btn",disabled:!t.svdContent,onClick:e[13]||(e[13]=(...i)=>n.downloadSvd&&n.downloadSvd(...i))}," 下载 ",8,Se)])]),s("div",ye,[s("textarea",{class:"config-output",readonly:"",value:t.svdContent},null,8,_e)])])],512),[[v,t.currentStep===5]])]),s("div",xe,[s("button",{class:"btn ghost",disabled:t.currentStep===1,onClick:e[14]||(e[14]=(...i)=>n.prevStep&&n.prevStep(...i))}," 上一步 ",8,ke),t.currentStep<5?(p(),c("button",{key:0,class:"btn primary",disabled:!n.canProceed,onClick:e[15]||(e[15]=(...i)=>n.nextStep&&n.nextStep(...i))}," 下一步 ",8,Ce)):(p(),c("button",{key:1,class:"btn primary",disabled:!n.canProceed,onClick:e[16]||(e[16]=(...i)=>n.generateFiles&&n.generateFiles(...i))}," 完成 ",8,we))])])}const Fe=x(k,[["render",Me],["__scopeId","data-v-772a3e52"]]);export{Fe as default};

import{o as c,b as p,a as e,t as m,k as u,z as l,A as f,B as a,F as b,j as h,C as v,D as g,E as x}from"./vendor-BJAQRKHk.js";import{_}from"./index-CtfK80iT.js";const M={name:"EmbeddedToolPage",data(){return{title:"调试器配置",currentStep:1,chipFamilies:["stm32","gd32","stc"],seriesMap:{stm32:["stm32f1","stm32f4","stm32h7"],gd32:["gd32f1","gd32f4"],stc:["stc89","stc12"]},chipFamily:"",chipSeries:"",chipModel:"",installPath:"",debuggerType:"openocd",debuggerInterface:"swd",toolConfig:"",ldScript:"",memoryX:"",svdContent:""}},computed:{canProceed(){return this.currentStep===1?!!this.chipFamily:this.currentStep===2?!!this.chipSeries:this.currentStep===3?!!this.chipModel:this.currentStep===4?!!this.installPath:this.currentStep===5?!!this.debuggerType&&!!this.debuggerInterface:!1},seriesOptions(){return this.seriesMap[this.chipFamily]||[]}},watch:{chipFamily(){this.seriesOptions.includes(this.chipSeries)||(this.chipSeries="")}},mounted(){document.title=this.title},methods:{nextStep(){this.canProceed&&this.currentStep<5&&(this.currentStep+=1)},prevStep(){this.currentStep>1&&(this.currentStep-=1)},getMemoryMap(o){return{stm32f1:{flash:"256K",ram:"64K"},stm32f4:{flash:"1024K",ram:"192K"},stm32h7:{flash:"2048K",ram:"512K"},gd32f1:{flash:"256K",ram:"64K"},gd32f4:{flash:"512K",ram:"128K"},stc89:{flash:"64K",ram:"4K"},stc12:{flash:"128K",ram:"8K"}}[o]||{flash:"256K",ram:"64K"}},buildOpenOcd(o,s,d,r){const t={stm32f1:"stm32f1x",stm32f4:"stm32f4x",stm32h7:"stm32h7x",gd32f1:"gd32f1x",gd32f4:"gd32f4x",stc89:"stc89",stc12:"stc12"},n={swd:{driver:"cmsis-dap",transport:"swd"},jtag:{driver:"jlink",transport:"jtag"},dap:{driver:"cmsis-dap",transport:"swd"},stlink:{driver:"stlink",transport:"swd"},jlink:{driver:"jlink",transport:"swd"},ulink:{driver:"ulink",transport:"swd"}},i=n[r]||n.swd,y=t[o]||o,S=s||o;return[`set TOOL_PATH ${d}`,`adapter driver ${i.driver}`,`transport select ${i.transport}`,`set CHIP ${S}`,`source [find target/${y}.cfg]`].join(`
`)},buildProbeRs(o,s,d){const r={swd:{probe:"auto",protocol:"swd"},jtag:{probe:"auto",protocol:"jtag"},dap:{probe:"cmsis-dap",protocol:"swd"},stlink:{probe:"stlink",protocol:"swd"},jlink:{probe:"jlink",protocol:"swd"},ulink:{probe:"ulink",protocol:"swd"}},t=r[d]||r.swd;return[`chip = "${o}"`,`probe = "${t.probe}"`,`protocol = "${t.protocol}"`,"speed = 4000",`install_path = "${s}"`].join(`
`)},buildPyOcd(o,s,d){const r={swd:{probe:"swd",frequency:4e6},jtag:{probe:"jtag",frequency:4e6},dap:{probe:"cmsis-dap",frequency:4e6},stlink:{probe:"stlink",frequency:4e6},jlink:{probe:"jlink",frequency:4e6},ulink:{probe:"ulink",frequency:4e6}},t=r[d]||r.swd;return["target:",`  name: ${o}`,"probe:",`  type: ${t.probe}`,`  frequency: ${t.frequency}`,"session:","  gdbserver_port: 3333",`  install_path: ${s}`].join(`
`)},buildLd(o){const s=this.getMemoryMap(o);return["ENTRY(Reset_Handler)","MEMORY","{",`  FLASH (rx) : ORIGIN = 0x08000000, LENGTH = ${s.flash}`,`  RAM (xrw) : ORIGIN = 0x20000000, LENGTH = ${s.ram}`,"}","_estack = ORIGIN(RAM) + LENGTH(RAM);","_Min_Heap_Size = 0x200;","_Min_Stack_Size = 0x400;","SECTIONS","{","  .isr_vector :","  {","    . = ALIGN(4);","    KEEP(*(.isr_vector))","    . = ALIGN(4);","  } > FLASH","  .text :","  {","    . = ALIGN(4);","    *(.text*)","    *(.rodata*)","    *(.glue_7)","    *(.glue_7t)","    *(.eh_frame)","    . = ALIGN(4);","    _etext = .;","  } > FLASH","  .ARM.exidx :","  {","    __exidx_start = .;","    *(.ARM.exidx*)","    __exidx_end = .;","  } > FLASH","  .data : AT (ADDR(.text) + SIZEOF(.text))","  {","    . = ALIGN(4);","    _sdata = .;","    *(.data*)","    . = ALIGN(4);","    _edata = .;","  } > RAM","  _sidata = LOADADDR(.data);","  .bss :","  {","    . = ALIGN(4);","    _sbss = .;","    *(.bss*)","    *(COMMON)","    . = ALIGN(4);","    _ebss = .;","  } > RAM","  ._user_heap_stack :","  {","    . = ALIGN(8);","    PROVIDE(end = .);","    PROVIDE(_end = .);","    . = . + _Min_Heap_Size;","    . = . + _Min_Stack_Size;","    . = ALIGN(8);","  } > RAM","}"].join(`
`)},buildSvd(o,s){const d=this.getMemoryMap(o),r=s||o,n={stm32f1:"CM3",stm32f4:"CM4",stm32h7:"CM7",gd32f1:"CM3",gd32f4:"CM4",stc89:"CM3",stc12:"CM3"}[o]||"CM3";return['<?xml version="1.0" encoding="UTF-8"?>',"<device>",`  <name>${r}</name>`,`  <series>${o}</series>`,"  <version>1.0</version>",`  <description>${r} Device</description>`,"  <vendor>Generic</vendor>","  <vendorID>GEN</vendorID>","  <addressUnitBits>8</addressUnitBits>","  <width>32</width>","  <size>32</size>","  <access>read-write</access>","  <resetValue>0x00000000</resetValue>","  <resetMask>0xFFFFFFFF</resetMask>","  <cpu>",`    <name>${n}</name>`,"    <revision>r0p0</revision>","    <endian>little</endian>","    <mpuPresent>false</mpuPresent>","    <fpuPresent>false</fpuPresent>","    <nvicPrioBits>4</nvicPrioBits>","    <vendorSystickConfig>false</vendorSystickConfig>","  </cpu>","  <memoryRegions>",`    <memoryRegion name="FLASH" type="Flash" start="0x08000000" size="${this.formatHexBytes(d.flash)}" />`,`    <memoryRegion name="RAM" type="RAM" start="0x20000000" size="${this.formatHexBytes(d.ram)}" />`,"  </memoryRegions>","  <peripherals>","    <peripheral>","      <name>PERIPH0</name>","      <baseAddress>0x40000000</baseAddress>","      <addressBlock>","        <offset>0x0</offset>","        <size>0x1000</size>","        <usage>registers</usage>","      </addressBlock>","      <registers>","        <register>","          <name>CTRL</name>","          <description>Control Register</description>","          <addressOffset>0x0</addressOffset>","          <size>32</size>","          <access>read-write</access>","          <resetValue>0x00000000</resetValue>","          <fields>","            <field>","              <name>EN</name>","              <bitOffset>0</bitOffset>","              <bitWidth>1</bitWidth>","            </field>","          </fields>","        </register>","      </registers>","    </peripheral>","  </peripherals>","</device>"].join(`
`)},formatHexBytes(o){return`0x${this.sizeToBytes(o).toString(16).toUpperCase()}`},sizeToBytes(o){if(typeof o=="number")return o;const d=String(o||"").trim().toUpperCase().match(/^(\d+)(K|M)?$/);if(!d)return 0;let r=Number(d[1]);return d[2]==="K"&&(r*=1024),d[2]==="M"&&(r*=1024*1024),r},buildMemoryX(o){const s=this.getMemoryMap(o);return["MEMORY","{",`  FLASH (rx) : ORIGIN = 0x08000000, LENGTH = ${s.flash}`,`  RAM (rwx) : ORIGIN = 0x20000000, LENGTH = ${s.ram}`,"}","","SECTIONS","{","  .text : { *(.text) } > FLASH","  .rodata : { *(.rodata) } > FLASH","  .data : { *(.data) } > RAM","  .bss : { *(.bss) } > RAM","  .uninit : { *(.uninit) } > RAM","}"].join(`
`)},generateFiles(){if(!this.canProceed)return;const o=this.installPath||"/opt/tools",s=this.chipSeries||this.chipFamily||"stm32f1",d=this.chipModel||s;this.debuggerType==="openocd"?this.toolConfig=this.buildOpenOcd(s,d,o,this.debuggerInterface):this.debuggerType==="probe-rs"?this.toolConfig=this.buildProbeRs(d,o,this.debuggerInterface):this.toolConfig=this.buildPyOcd(d,o,this.debuggerInterface),this.ldScript=this.buildLd(s),this.memoryX=this.buildMemoryX(s),this.svdContent=this.buildSvd(s,d)},copyConfig(){this.toolConfig&&navigator.clipboard&&navigator.clipboard.writeText(this.toolConfig)},copyLd(){this.ldScript&&navigator.clipboard&&navigator.clipboard.writeText(this.ldScript)},copyMemoryX(){this.memoryX&&navigator.clipboard&&navigator.clipboard.writeText(this.memoryX)},downloadConfig(){if(!this.toolConfig)return;const o=`${this.debuggerType}-${this.fileSuffix()}.cfg`;this.downloadFile(this.toolConfig,o)},downloadLd(){if(!this.ldScript)return;const o=`${this.fileSuffix()}.ld`;this.downloadFile(this.ldScript,o)},downloadMemoryX(){if(!this.memoryX)return;this.downloadFile(this.memoryX,"memory.x")},downloadSvd(){if(!this.svdContent)return;const o=`${this.fileSuffix()}.svd`;this.downloadFile(this.svdContent,o)},fileSuffix(){return(this.chipModel||this.chipSeries||this.chipFamily||"chip").toLowerCase()},downloadFile(o,s){const d=new Blob([o],{type:"text/plain;charset=utf-8"}),r=document.createElement("a");r.href=URL.createObjectURL(d),r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)},openDirPicker(){this.$refs.dirPicker&&this.$refs.dirPicker.click()},onDirPicked(o){const s=Array.from(o.target.files||[]);if(!s.length)return;const d=o.target.value||"",r=s[0].name||"";this.installPath=d||r||this.installPath}}},k={class:"gateway-wrap"},w={class:"header"},C={class:"title"},L={class:"steps"},A={class:"form-card"},F={class:"panel"},P={class:"section"},R={class:"section-body"},I={class:"form-row"},N={class:"control"},T=["value"],O={class:"panel"},j={class:"section"},D={class:"section-body"},E={class:"form-row"},G={class:"control"},H=["value"],K={class:"panel"},X={class:"section"},z={class:"section-body"},B={class:"form-row"},U={class:"control"},V={class:"panel"},q={class:"section"},W={class:"section-body"},Y={class:"form-row"},J={class:"control"},Z={class:"panel"},Q={class:"section"},$={class:"section-title"},ss={class:"section-actions"},es=["disabled"],ts=["disabled"],is={class:"section-body"},os={class:"form-row"},ns={class:"control"},rs={class:"form-row"},ds={class:"control"},ls=["value"],as={class:"section"},cs={class:"section-title"},ps={class:"section-actions"},us=["disabled"],fs=["disabled"],vs={class:"section-body"},ms=["value"],bs={class:"section"},hs={class:"section-title"},gs={class:"section-actions"},ys=["disabled"],Ss=["disabled"],xs={class:"section-body"},_s=["value"],Ms={class:"section"},ks={class:"section-title"},ws={class:"section-actions"},Cs=["disabled"],Ls={class:"section-body"},As=["value"],Fs={class:"footer-actions"},Ps=["disabled"],Rs=["disabled"],Is=["disabled"];function Ns(o,s,d,r,t,n){return c(),p("div",k,[e("div",w,[e("div",C,m(t.title),1)]),e("div",L,[e("div",{class:u(["step",{active:t.currentStep===1,done:t.currentStep>1}])},[...s[19]||(s[19]=[e("div",{class:"step-index"}," 1 ",-1),e("div",{class:"step-text"}," 选择芯片大类 ",-1)])],2),s[24]||(s[24]=e("div",{class:"step-line"},null,-1)),e("div",{class:u(["step",{active:t.currentStep===2,done:t.currentStep>2}])},[...s[20]||(s[20]=[e("div",{class:"step-index"}," 2 ",-1),e("div",{class:"step-text"}," 选择子类 ",-1)])],2),s[25]||(s[25]=e("div",{class:"step-line"},null,-1)),e("div",{class:u(["step",{active:t.currentStep===3,done:t.currentStep>3}])},[...s[21]||(s[21]=[e("div",{class:"step-index"}," 3 ",-1),e("div",{class:"step-text"}," 输入芯片型号 ",-1)])],2),s[26]||(s[26]=e("div",{class:"step-line"},null,-1)),e("div",{class:u(["step",{active:t.currentStep===4,done:t.currentStep>4}])},[...s[22]||(s[22]=[e("div",{class:"step-index"}," 4 ",-1),e("div",{class:"step-text"}," 选择可执行文件 ",-1)])],2),s[27]||(s[27]=e("div",{class:"step-line"},null,-1)),e("div",{class:u(["step",{active:t.currentStep===5,done:t.currentStep>5}])},[...s[23]||(s[23]=[e("div",{class:"step-index"}," 5 ",-1),e("div",{class:"step-text"}," 生成配置文件 ",-1)])],2)]),e("div",A,[l(e("div",F,[e("div",P,[s[30]||(s[30]=e("div",{class:"section-title"}," 芯片大类 ",-1)),e("div",R,[e("div",I,[s[29]||(s[29]=e("div",{class:"label"},[e("span",{class:"required"},"*"),a("芯片大类 ")],-1)),e("div",N,[l(e("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.chipFamily=i),class:"input"},[s[28]||(s[28]=e("option",{value:""}," 请选择 ",-1)),(c(!0),p(b,null,h(t.chipFamilies,i=>(c(),p("option",{key:i,value:i},m(i),9,T))),128))],512),[[v,t.chipFamily]])])])])])],512),[[f,t.currentStep===1]]),l(e("div",O,[e("div",j,[s[33]||(s[33]=e("div",{class:"section-title"}," 芯片子类 ",-1)),e("div",D,[e("div",E,[s[32]||(s[32]=e("div",{class:"label"},[e("span",{class:"required"},"*"),a("芯片子类 ")],-1)),e("div",G,[l(e("select",{"onUpdate:modelValue":s[1]||(s[1]=i=>t.chipSeries=i),class:"input"},[s[31]||(s[31]=e("option",{value:""}," 请选择 ",-1)),(c(!0),p(b,null,h(n.seriesOptions,i=>(c(),p("option",{key:i,value:i},m(i),9,H))),128))],512),[[v,t.chipSeries]])])])])])],512),[[f,t.currentStep===2]]),l(e("div",K,[e("div",X,[s[35]||(s[35]=e("div",{class:"section-title"}," 芯片型号 ",-1)),e("div",z,[e("div",B,[s[34]||(s[34]=e("div",{class:"label"},[e("span",{class:"required"},"*"),a("芯片型号 ")],-1)),e("div",U,[l(e("input",{"onUpdate:modelValue":s[2]||(s[2]=i=>t.chipModel=i),class:"input",placeholder:"例如 STM32F103C8T6"},null,512),[[g,t.chipModel]])])])])])],512),[[f,t.currentStep===3]]),l(e("div",V,[e("div",q,[s[37]||(s[37]=e("div",{class:"section-title"}," 可执行文件 ",-1)),e("div",W,[e("div",Y,[s[36]||(s[36]=e("div",{class:"label"},[e("span",{class:"required"},"*"),a("可执行文件 ")],-1)),e("div",J,[l(e("input",{"onUpdate:modelValue":s[3]||(s[3]=i=>t.installPath=i),class:"input",placeholder:"请选择调试器可执行文件",readonly:""},null,512),[[g,t.installPath]]),e("button",{class:"btn ghost",onClick:s[4]||(s[4]=(...i)=>n.openDirPicker&&n.openDirPicker(...i))}," 选择文件 "),e("input",{ref:"dirPicker",class:"dir-input",type:"file",onChange:s[5]||(s[5]=(...i)=>n.onDirPicked&&n.onDirPicked(...i))},null,544)])])])])],512),[[f,t.currentStep===4]]),l(e("div",Z,[e("div",Q,[e("div",$,[s[38]||(s[38]=a(" 配置文件 ",-1)),e("div",ss,[e("button",{class:"btn",onClick:s[6]||(s[6]=(...i)=>n.generateFiles&&n.generateFiles(...i))}," 生成 "),e("button",{class:"btn",disabled:!t.toolConfig,onClick:s[7]||(s[7]=(...i)=>n.copyConfig&&n.copyConfig(...i))}," 复制 ",8,es),e("button",{class:"btn",disabled:!t.toolConfig,onClick:s[8]||(s[8]=(...i)=>n.downloadConfig&&n.downloadConfig(...i))}," 下载 ",8,ts)])]),e("div",is,[e("div",os,[s[40]||(s[40]=e("div",{class:"label"},[e("span",{class:"required"},"*"),a("调试器 ")],-1)),e("div",ns,[l(e("select",{"onUpdate:modelValue":s[9]||(s[9]=i=>t.debuggerType=i),class:"input"},[...s[39]||(s[39]=[e("option",{value:"openocd"}," openocd ",-1),e("option",{value:"probe-rs"}," probe-rs ",-1),e("option",{value:"pyocd"}," pyocd ",-1)])],512),[[v,t.debuggerType]])])]),e("div",rs,[s[42]||(s[42]=e("div",{class:"label"},[e("span",{class:"required"},"*"),a("调试器接口 ")],-1)),e("div",ds,[l(e("select",{"onUpdate:modelValue":s[10]||(s[10]=i=>t.debuggerInterface=i),class:"input"},[...s[41]||(s[41]=[x('<option value="swd" data-v-3f22b61e> SWD </option><option value="jtag" data-v-3f22b61e> JTAG </option><option value="dap" data-v-3f22b61e> DAP </option><option value="stlink" data-v-3f22b61e> STLink </option><option value="jlink" data-v-3f22b61e> JLink </option><option value="ulink" data-v-3f22b61e> ULink </option>',6)])],512),[[v,t.debuggerInterface]])])]),e("textarea",{class:"config-output",readonly:"",value:t.toolConfig},null,8,ls)])]),s[46]||(s[46]=e("div",{class:"divider"},null,-1)),e("div",as,[e("div",cs,[s[43]||(s[43]=a(" LD 文件 ",-1)),e("div",ps,[e("button",{class:"btn",disabled:!t.ldScript,onClick:s[11]||(s[11]=(...i)=>n.copyLd&&n.copyLd(...i))}," 复制 ",8,us),e("button",{class:"btn",disabled:!t.ldScript,onClick:s[12]||(s[12]=(...i)=>n.downloadLd&&n.downloadLd(...i))}," 下载 ",8,fs)])]),e("div",vs,[e("textarea",{class:"config-output",readonly:"",value:t.ldScript},null,8,ms)])]),s[47]||(s[47]=e("div",{class:"divider"},null,-1)),e("div",bs,[e("div",hs,[s[44]||(s[44]=a(" Memory.x 文件 ",-1)),e("div",gs,[e("button",{class:"btn",disabled:!t.memoryX,onClick:s[13]||(s[13]=(...i)=>n.copyMemoryX&&n.copyMemoryX(...i))}," 复制 ",8,ys),e("button",{class:"btn",disabled:!t.memoryX,onClick:s[14]||(s[14]=(...i)=>n.downloadMemoryX&&n.downloadMemoryX(...i))}," 下载 ",8,Ss)])]),e("div",xs,[e("textarea",{class:"config-output",readonly:"",value:t.memoryX},null,8,_s)])]),s[48]||(s[48]=e("div",{class:"divider"},null,-1)),e("div",Ms,[e("div",ks,[s[45]||(s[45]=a(" SVD 文件 ",-1)),e("div",ws,[e("button",{class:"btn",disabled:!t.svdContent,onClick:s[15]||(s[15]=(...i)=>n.downloadSvd&&n.downloadSvd(...i))}," 下载 ",8,Cs)])]),e("div",Ls,[e("textarea",{class:"config-output",readonly:"",value:t.svdContent},null,8,As)])])],512),[[f,t.currentStep===5]])]),e("div",Fs,[e("button",{class:"btn ghost",disabled:t.currentStep===1,onClick:s[16]||(s[16]=(...i)=>n.prevStep&&n.prevStep(...i))}," 上一步 ",8,Ps),t.currentStep<5?(c(),p("button",{key:0,class:"btn primary",disabled:!n.canProceed,onClick:s[17]||(s[17]=(...i)=>n.nextStep&&n.nextStep(...i))}," 下一步 ",8,Rs)):(c(),p("button",{key:1,class:"btn primary",disabled:!n.canProceed,onClick:s[18]||(s[18]=(...i)=>n.generateFiles&&n.generateFiles(...i))}," 完成 ",8,Is))])])}const js=_(M,[["render",Ns],["__scopeId","data-v-3f22b61e"]]);export{js as default};
